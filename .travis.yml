language: python
python: '2.7'
sudo: false
env:
  global:
    - APPENGINE_VERSION=1.9.24
install:
  - cd .. && git clone https://github.com/getpelican/pelican-plugins.git && cd $TRAVIS_BUILD_DIR
  - pip install -r requirements.txt
script:
  - make publish
  - cd $HOME
  - wget https://dl.google.com/dl/cloudsdk/release/google-cloud-sdk.zip
  - unzip -qq google-cloud-sdk.zip
  - google-cloud-sdk/install.sh --usage-reporting false --path-update false --rc-path=~/.bashrc --bash-completion false --override-components=app
  - google-cloud-sdk/bin/gcloud components update preview app --quiet
  - openssl aes-256-cbc -K $encrypted_3551f66ee127_key -iv $encrypted_3551f66ee127_iv -in "${TRAVIS_BUILD_DIR}/gae_key" -out blog-onthewings-8a1538b1718e.json -d
  - google-cloud-sdk/bin/gcloud auth activate-service-account --key-file blog-onthewings-8a1538b1718e.json
  - google-cloud-sdk/bin/gcloud --project blog-onthewings preview app deploy --quiet "${TRAVIS_BUILD_DIR}/app.yaml"
